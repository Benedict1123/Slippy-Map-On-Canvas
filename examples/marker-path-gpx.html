<!DOCTYPE html>
<html manifest="map.manifest">
	<head>
		<meta charset="utf-8">
		<title>Slippy Map on Canvas (HTML5) | simple gpx2geojson example</title>
		<meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=no;"/>
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<link rel="apple-touch-icon-precomposed" href="../images/touch-icon.png" />
		<link href="../css/map.css" rel="stylesheet" type="text/css" media="all" />
		<link href="../css/ui.css" rel="stylesheet" type="text/css" media="all" />
		<script src="../js/map.js" type="text/javascript"></script>
		<script type="text/javascript">
			var tracks = {};
			var app = app || {};
			function gpxtrack(data){
				var features = data.features || [];
				app.markers = {};
				for(var f=0; f<features.length; f++){
					var feature = features[f];
					switch(feature.properties.gpxtype){
						case "wptType" :
										app.markers[feature.properties.name || f] =
											{	src : "../images/marker.png",
												lon : feature.geometry.coordinates[0],
												lat : feature.geometry.coordinates[1],
												offsetX : -11,
												offsetY : -25
											}
										break;
						case "trkType" :
										var path = feature.geometry.coordinates[0];
										var points = [];
										for(var p=0; p<path.length; p++){
											points.push(path[p]);
										}
										tracks[feature.properties.name || f] = {
												strokeStyle : "#ff0",
												lineWidth : 4,
												points : points
										};
										break;

						default :		console.log(feature.properties.gpxtype);
					}
				}
			}
			app.preInitListeners.push(function(){
				drawPath = function(z,zp,sz,xMin,xMax,yMin,yMax){

					function lon2x(lon){
				        return Math.round((app.pos.lon2pos(lon)-xMin) / zp);
				    }

					function lat2y(lat){
                        return Math.round((app.pos.lat2pos(lat)-yMin) / zp) ;
					}
					for(t in tracks){
						var track = tracks[t];
						app.renderer.context.strokeStyle = track.strokeStyle;
						app.renderer.context.lineWidth   = track.lineWidth;
						app.renderer.context.beginPath();
						app.renderer.context.moveTo(lon2x(track.points[0][0]), lat2y(track.points[0][1]));
						for(var i=1; i<track.points.length; i++){
							app.renderer.context.lineTo(lon2x(track.points[i][0]), lat2y(track.points[i][1]));	
						}
						app.renderer.context.stroke();
						app.renderer.context.closePath();
					}
				}
				app.renderer.addLayer({ zindex: 10, callback: drawPath});
            });
			app.postInitListeners.push(function(){
				app.recenter(-0.728800, 51.370710, 16);
			});
		</script>
		<script src="http://gpx2geojson.appspot.com/?gpxurl=http://wtp2.appspot.com/SwinleyForest.gpx&mime=text/plain&callback=gpxtrack" type="text/javascript"></script>

	</head>
	<body>
		<canvas id="map">
			Your  browser doesn't support canvas elements.			
		</canvas>
		<ul id="buttons">
			<li><a class="zoomin" href="javascript:;" onclick="app.zoomIn(); return false;">+</a></li>
			<li><a class="zoomout" href="javascript:;" onclick="app.zoomOut(); return false;">-</a></li>
		</ul>
	</body>
</html>